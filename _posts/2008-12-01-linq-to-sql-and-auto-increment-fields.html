---
layout: post
title: LINQ to SQL and auto increment fields
date: 2008-12-01 19:06:13.000000000 +01:00
categories: []
tags:
- LINQ
- LINQ to SQL
- Visual Studio 2005
status: publish
type: post
published: true
meta: {}
author:
  login: admin
  email: pvlerick@gmail.com
  display_name: Philippe
  first_name: Philippe
  last_name: Vl√©rick
excerpt: !ruby/object:Hpricot::Doc
  options: {}
---
<p>When using LINQ to SQL in Visual Studio 2005, <a href="http://msdn.microsoft.com/fr-fr/library/system.data.linq.mapping.tableattribute.aspx">Table</a> and <a href="http://msdn.microsoft.com/fr-fr/library/system.data.linq.mapping.columnattribute.aspx">Column</a> mapping has to be coded manually. This is not a very difficult job but it's repetitive and boring (of course, if you are using Visual Studio 2008 to automatically generated the mapping code, this will be done automatically).</p>
<p>I ran into an issue while following a guide on manually map database tables to classes. When I tried to insert a new record, leaving the identity field empty in the object, I had the following error:</p>
<blockquote><p>&quot;Cannot insert explicit value for identity column in table 'Contexts' when IDENTITY_INSERT is set to OFF.&quot;</p>
</blockquote>
<p>It was pretty obvious that, as the identity column was and Int32, it was set to 0 as default, and when LINQ tried to insert that row in the table the SQL Server raised an error as this auto incremented field cannot be explicitly set.</p>
<p>This is simply solved by using the <em><a href="http://msdn.microsoft.com/en-us/library/system.data.linq.mapping.columnattribute.isdbgenerated.aspx">IsDbGenerated</a></em> attribute in the Column annotation description of the field, as shown in the following code.</p>
<pre class="code"><span style="color: blue">private </span><span style="color: #2b91af">Int32 </span>_id;

[<span style="color: #2b91af">Column</span>(IsPrimaryKey = <span style="color: blue">true</span>, IsDbGenerated = <span style="color: blue">true</span>)]
<span style="color: blue">public </span><span style="color: #2b91af">Int32 </span>Id { <span style="color: blue">get </span>{ <span style="color: blue">return this</span>._id; } <span style="color: blue">set </span>{ <span style="color: blue">this</span>._id = <span style="color: blue">value</span>; } }</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>This attribute tells LINQ not to give a value for this field as it is generated by the database at insert time.</p>
<p>Another very nice thing about this is that once you have inserted the object in the database, this field will hold the value generated by the database. Practically, this means that after executing the following code</p>
<pre class="code">DataTable.InsertOnSubmit(obj);
DataContext.SubmitChanges();</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>the <em>obj.Id</em> property will contain the value that was assigned by the database.</p>
